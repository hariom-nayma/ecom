<div class="container" *ngIf="product">
  <mat-card class="product-detail-card">
    <div class="row">
      <div class="col-md-6">
        <img mat-card-image [src]="product.imageUrl || 'https://via.placeholder.com/600x400'" alt="{{ product.name }}">
      </div>
      <div class="col-md-6">
        <mat-card-header>
          <mat-card-title>{{ product.name }}</mat-card-title>
          <mat-card-subtitle>{{ product.categoryName }}</mat-card-subtitle>
        </mat-card-header>
        <mat-card-content>
          <p class="description">{{ product.description }}</p>
          <p class="price">{{ product.discountPrice | currency:"INR" }} <span *ngIf="product.discountPercent > 0" class="original-price"><del>{{ product.price | currency:"INR" }}</del></span></p>
          <p *ngIf="product.discountPercent > 0" class="discount">{{ product.discountPercent }}% off</p>
          <p class="stock"><strong>Stock:</strong> {{ product.stock }}</p>
        </mat-card-content>
        <mat-card-actions>
          <ng-container *ngIf="getProductQuantity(product.id.toString()) === 0; else quantityControls">
            <button mat-raised-button color="accent" (click)="addToCart(product)">
              <mat-icon>add_shopping_cart</mat-icon> Add to Cart
            </button>
          </ng-container>
          <ng-template #quantityControls>
            <div class="quantity-controls">
              <button mat-mini-fab color="warn" (click)="decreaseQuantity(product.id.toString())">-</button>
              <span>{{ getProductQuantity(product.id.toString()) }}</span>
              <button mat-mini-fab color="primary" (click)="increaseQuantity(product)" [disabled]="getProductQuantity(product.id.toString()) >= product.stock">+</button>
            </div>
          </ng-template>
        </mat-card-actions>
      </div>
    </div>
  </mat-card>

  <div class="similar-products" *ngIf="similarProducts.length > 0">
    <h2>Similar Products</h2>
    <div class="products-grid">
      <mat-card class="product-card" *ngFor="let similarProduct of similarProducts">
        <img mat-card-image [src]="similarProduct.imageUrl || 'https://via.placeholder.com/400x300'" alt="{{ similarProduct.name }}" [routerLink]="['/products', similarProduct.id]">
        <mat-card-header>
          <mat-card-title>{{ similarProduct.name }}</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <p class="price">{{ similarProduct.discountPrice | currency:"INR" }}</p>
        </mat-card-content>
        <mat-card-actions>
          <ng-container *ngIf="getProductQuantity(similarProduct.id.toString()) === 0; else quantityControls">
            <button *ngIf="similarProduct.stock!=0" mat-flat-button color="accent" (click)="addToCart(similarProduct)">Add to Cart</button>
          </ng-container>
          <ng-template #quantityControls>
            <div class="quantity-controls">
              <button mat-mini-fab color="warn" (click)="decreaseQuantity(similarProduct.id.toString())">-</button>
              <span>{{ getProductQuantity(similarProduct.id.toString()) }}</span>
              <button mat-mini-fab color="primary" (click)="increaseQuantity(similarProduct)" [disabled]="getProductQuantity(similarProduct.id.toString()) >= similarProduct.stock">+</button>
            </div>
          </ng-template>
        </mat-card-actions>
      </mat-card>
    </div>
  </div>
</div>